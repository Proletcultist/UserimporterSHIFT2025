# Задание

## 1. Общая формулировка:

Необходимо создать приложение, которое будет обновлять список пользователей системы с помощью загружаемого файла.

## 2. Общие требования к функционалу

### Сервис предоставляет следующие возможности:

- Получение списка пользователей системы;
- Загрузка файла с пользователями;
- Запуск обработки файла;
- Получение информации о файлах со статистикой обработки;
- Получение информации о файле с детализированной статистикой обработки.

### Для обновления списка пользователей следует выполнить следующие шаги:

1. Загрузить файл с пользователями.
2. Запустить обработку файла по полученному на шаге 1 идентификатору файла.
3. Проверить обработку файла запросив статистику обработки.
4. В случаем наличия ошибок в статистике, запросить статистику с детализацией ошибок, исправить данные и повторить попытку.
5. Проверить что пользователи появились, запросив список пользователей.

### Статусы информация о файле:
- Сразу после сохранения файла в бд сохраняется информация о файле со статусом NEW
- После запуска обработки файла статус меняется на IN_PROGRESS
- В случае нормального завершения обработки, даже при наличии ошибок для конкретных строк статус меняется на DONE
- В случае досрочного завершения обработки с какой-либо ошибкой статус меняется на FAILED

## 3. API сервиса и схема базы данных

Для экономии времени и упрощения проверки вам предоставляются [API](api/openapi.yaml) и [Схема БД](images/database_schema.png)

## 4. Детальное описание функционала

### Загрузка файла

- При загрузке [файла](Требования%20к%20файлу.md) содержащего список пользователей для
  обновления/добавления файл загружается на файловую систему сервиса и информация о загруженной
  файле сохраняется в базе данных

[диаграмма](images/save_file.png)

### Запуск и обработка файла

1) Сначала проверяется наличие файла и отдается на асинхронную обработку.
2) Обработчик построчно считывает файл, проверяя формат и корректность данных согласно [требований](Требования%20к%20файлу.md).
3) В случае корректности, данные по каждому пользователю сохраняются в БД.
4) Информация по ошибочным строкам сохраняется в БД с описанием для какой строки и что не верно
5) Статистика обработки всего файла также сохраняется в БД.

[диаграмма](images/process_file.png)

> В рамках задания мы не ограничиваем вас, вы можете самостоятельно расширить требования задачи при желании, предварительно согласовав это с кураторами
